# HKChat API - æ™ºèƒ½èŠå¤©åç«¯æœåŠ¡

HKChat API æ˜¯ä¸€ä¸ªåŸºäº Go è¯­è¨€å¼€å‘çš„ç®€æ´é«˜æ•ˆçš„æ™ºèƒ½èŠå¤©åç«¯æœåŠ¡ï¼Œæ”¯æŒ OpenAI æ¨¡å‹é›†æˆå’Œå®æ—¶èŠå¤©åŠŸèƒ½ã€‚

## ğŸ“‹ å¿«é€Ÿå¯¼èˆª

- [ğŸ—ï¸ ç³»ç»Ÿæ¶æ„æ–‡æ¡£](./docs/architecture/README.md)
- [ğŸ¤– LLM é›†æˆæ¶æ„](./docs/architecture/llm-integration.md)
- [ğŸ“– API æ–‡æ¡£](./docs/swagger.yaml)
- [ğŸš€ å¼€å‘è„šæœ¬è¯´æ˜](./scripts/README.md)

## ğŸš€ é¡¹ç›®æ¦‚è¿°

HKChat API æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„æ™ºèƒ½èŠå¤©åç«¯æœåŠ¡ï¼Œé›†æˆäº† RAG (æ£€ç´¢å¢å¼ºç”Ÿæˆ) ç³»ç»Ÿå’Œå‘é‡æ•°æ®åº“ã€‚

### æ ¸å¿ƒç‰¹æ€§

- âœ… **OpenAI é›†æˆ**: æ”¯æŒ GPT æ¨¡å‹çš„èŠå¤©å®Œæˆ
- âœ… **RAG ç³»ç»Ÿ**: æ–‡æ¡£ä¸Šä¼ ã€å‘é‡åŒ–ã€æ™ºèƒ½æ£€ç´¢
- âœ… **Milvus å‘é‡æ•°æ®åº“**: é«˜æ€§èƒ½å‘é‡å­˜å‚¨å’Œç›¸ä¼¼åº¦æœç´¢
- âœ… **çŸ¥è¯†åº“ç®¡ç†**: æ–‡æ¡£è§£æã€åˆ†å—ã€å‘é‡åŒ–å­˜å‚¨
- âœ… **ç®€æ´æ¶æ„**: åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤
- âœ… **é…ç½®ç®¡ç†**: ç¯å¢ƒå˜é‡å’Œ YAML é…ç½®æ”¯æŒ
- âœ… **æ•°æ®æŒä¹…åŒ–**: PostgreSQL + Redis + Milvus
- âœ… **API æ–‡æ¡£**: Swagger è‡ªåŠ¨ç”Ÿæˆçš„ API æ–‡æ¡£
- âœ… **ä¸€é”®éƒ¨ç½²**: Windows æ‰¹å¤„ç†è„šæœ¬å¿«é€Ÿå¯åŠ¨

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯å±‚      â”‚â”€â”€â”€â–¶â”‚   API è·¯ç”±å±‚     â”‚â”€â”€â”€â–¶â”‚   ä¸­é—´ä»¶å±‚      â”‚
â”‚ Web/Mobile App  â”‚    â”‚  Gin Router      â”‚    â”‚  Auth/CORS      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä¸šåŠ¡æœåŠ¡å±‚                                 â”‚
â”‚           ChatService â”‚ LLM Gateway â”‚ OpenAI Client              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®è®¿é—®å±‚ (Repository)                      â”‚
â”‚              ChatRepo â”‚ UserRepo â”‚ ModelRepo                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•°æ®å­˜å‚¨å±‚                                 â”‚
â”‚                       PostgreSQL                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
hkchat_api/
â”œâ”€â”€ api/                    # API è·¯ç”±å±‚
â”‚   â”œâ”€â”€ chat_api_routes.go  # èŠå¤© API è·¯ç”±
â”‚   â”œâ”€â”€ middleware/         # è®¤è¯ä¸­é—´ä»¶
â”‚   â””â”€â”€ registry.go         # è·¯ç”±æ³¨å†Œå™¨
â”œâ”€â”€ cmd/server/             # æœåŠ¡å™¨å¯åŠ¨å…¥å£
â”œâ”€â”€ config/                 # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ dev.yaml           # å¼€å‘ç¯å¢ƒé…ç½®
â”‚   â””â”€â”€ prod.yaml          # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”œâ”€â”€ docs/                   # æ–‡æ¡£å’ŒAPIè§„èŒƒ
â”œâ”€â”€ internal/              # å†…éƒ¨æ¨¡å—
â”‚   â”œâ”€â”€ config/            # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ core/llm/          # LLM ç½‘å…³å’Œé›†æˆ
â”‚   â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ entities/      # æ•°æ®åº“å®ä½“
â”‚   â”‚   â”œâ”€â”€ dto/           # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â””â”€â”€ domain/        # é¢†åŸŸæ¨¡å‹
â”‚   â”œâ”€â”€ repository/        # æ•°æ®è®¿é—®å±‚
â”‚   â””â”€â”€ services/          # ä¸šåŠ¡æœåŠ¡å±‚
â”œâ”€â”€ pkg/                   # å…¬å…±åŒ…
â”‚   â”œâ”€â”€ auth/              # JWTè®¤è¯
â”‚   â”œâ”€â”€ clients/           # å¤–éƒ¨å®¢æˆ·ç«¯ (OpenAI, æ•°æ®åº“)
â”‚   â”œâ”€â”€ prompts/           # æç¤ºè¯æ¨¡æ¿
â”‚   â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
â”œâ”€â”€ scripts/               # å¼€å‘è„šæœ¬
â”œâ”€â”€ go.mod                 # ä¾èµ–ç®¡ç†
â””â”€â”€ main.go               # å¼€å‘å·¥å…·å…¥å£
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **Web æ¡†æ¶**: [Gin](https://github.com/gin-gonic/gin) - é«˜æ€§èƒ½ HTTP Web æ¡†æ¶
- **ORM**: [GORM](https://gorm.io/) - Go è¯­è¨€ ORM åº“  
- **å…³ç³»æ•°æ®åº“**: [PostgreSQL](https://www.postgresql.org/) - ä¸»æ•°æ®å­˜å‚¨
- **å‘é‡æ•°æ®åº“**: [Milvus](https://milvus.io/) - é«˜æ€§èƒ½å‘é‡å­˜å‚¨å’Œæ£€ç´¢
- **ç¼“å­˜**: [Redis](https://redis.io/) - å†…å­˜ç¼“å­˜æ•°æ®åº“
- **LLM é›†æˆ**: [OpenAI API](https://openai.com/api/) - GPT æ¨¡å‹å’Œ Embeddings
- **RAG ç³»ç»Ÿ**: æ–‡æ¡£è§£æã€æ–‡æœ¬åˆ†å—ã€å‘é‡åŒ–ã€ç›¸ä¼¼åº¦æœç´¢
- **æ–‡æ¡£**: [Swagger](https://swagger.io/) - API æ–‡æ¡£ç”Ÿæˆ
- **å®¹å™¨åŒ–**: [Docker](https://www.docker.com/) - æœåŠ¡å®¹å™¨åŒ–éƒ¨ç½²

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Go 1.21+
- Docker Desktop (ç”¨äºè¿è¡Œæ•°æ®åº“å’Œå‘é‡æ•°æ®åº“)
- OpenAI API Key

### Windows ä¸€é”®å¯åŠ¨ (æ¨è)

1. **å…‹éš†é¡¹ç›®**
```bash
git clone <repository-url>
cd hkchat_api_go
```

2. **ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡**
```bash
# è¿è¡Œå¯åŠ¨è„šæœ¬ (ä¼šè‡ªåŠ¨å¯åŠ¨ Milvus + PostgreSQL + Redis)
scripts\start-hkchat.bat
```

3. **å¯åŠ¨ä¸»åº”ç”¨**
```bash
# å¼€å‘æ¨¡å¼
go run main.go

# æˆ–æ„å»ºåè¿è¡Œ
go build -o hkchat_api.exe
hkchat_api.exe
```

4. **è®¿é—®æœåŠ¡**
- API æœåŠ¡: http://localhost:8080
- Swagger æ–‡æ¡£: http://localhost:8080/swagger/index.html
- å¥åº·æ£€æŸ¥: http://localhost:8080/health

### æ‰‹åŠ¨å¯åŠ¨ (Linux/Mac)

1. **å…‹éš†é¡¹ç›®**
```bash
git clone <repository-url>
cd hkchat_api_go
```

2. **é…ç½®ç¯å¢ƒå˜é‡**
```bash
cp env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œè®¾ç½® OPENAI_API_KEY
```

3. **å¯åŠ¨æœåŠ¡ä¾èµ–**
```bash
# å¯åŠ¨ Milvus å‘é‡æ•°æ®åº“
curl -sfL https://raw.githubusercontent.com/milvus-io/milvus/master/scripts/standalone_embed.sh -o standalone_embed.sh
bash standalone_embed.sh start

# å¯åŠ¨ PostgreSQL å’Œ Redis
cd deploy/docker
docker compose -f docker-compose-services.yml up -d
cd ../..
```

4. **è¿è¡Œåº”ç”¨**
```bash
go run main.go
```

### åœæ­¢æœåŠ¡

```bash
# Windows
scripts\stop-hkchat.bat

# Linux/Mac
bash standalone_embed.sh stop
cd deploy/docker && docker compose -f docker-compose-services.yml down
```

## âš™ï¸ é…ç½®ç®¡ç†

### ç¯å¢ƒå˜é‡

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `DB_HOST` | æ•°æ®åº“ä¸»æœº | localhost |
| `DB_PORT` | æ•°æ®åº“ç«¯å£ | 5432 |
| `DB_USER` | æ•°æ®åº“ç”¨æˆ·å | postgres |
| `DB_PASSWORD` | æ•°æ®åº“å¯†ç  | - |
| `DB_NAME` | æ•°æ®åº“åç§° | hkchat |
| `OPENAI_API_KEY` | OpenAI API å¯†é’¥ | - |
| `APP_PORT` | æœåŠ¡ç«¯å£ | 8080 |

### é…ç½®æ–‡ä»¶

é¡¹ç›®æ”¯æŒå¤šç¯å¢ƒé…ç½®ï¼Œé…ç½®æ–‡ä»¶ä½äº `config/` ç›®å½•ï¼š

- `dev.yaml`: å¼€å‘ç¯å¢ƒé…ç½®
- `prod.yaml`: ç”Ÿäº§ç¯å¢ƒé…ç½®

## ğŸ“– å¼€å‘æŒ‡å—

### ä»£ç ç»“æ„

é¡¹ç›®é‡‡ç”¨ç®€æ´çš„ä¸‰å±‚æ¶æ„ï¼š

1. **API å±‚** (`api/`): HTTP è·¯ç”±å’Œä¸­é—´ä»¶
2. **æœåŠ¡å±‚** (`internal/services/`): ä¸šåŠ¡é€»è¾‘å¤„ç†  
3. **ä»“å‚¨å±‚** (`internal/repository/`): æ•°æ®è®¿é—®å±‚
4. **æ¨¡å‹å±‚** (`internal/models/`): æ•°æ®æ¨¡å‹å®šä¹‰

### æ·»åŠ æ–°åŠŸèƒ½

1. åœ¨ `internal/models/entities/` å®šä¹‰æ•°æ®å®ä½“
2. åœ¨ `internal/repository/` å®ç°æ•°æ®è®¿é—®é€»è¾‘
3. åœ¨ `internal/services/` å®ç°ä¸šåŠ¡é€»è¾‘
4. åœ¨ `api/` æ·»åŠ  HTTP è·¯ç”±

### å¼€å‘å‘½ä»¤

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
go run main.go run

# æ ¼å¼åŒ–ä»£ç 
go run main.go fmt

# æ„å»ºé¡¹ç›®
go run main.go build

# æ¸…ç†æ„å»ºæ–‡ä»¶
go run main.go clean
```

## ğŸ”— ç›¸å…³é“¾æ¥

- [ç³»ç»Ÿæ¶æ„æ–‡æ¡£](./docs/architecture/README.md)
- [LLM é›†æˆæ–‡æ¡£](./docs/architecture/llm-integration.md)
- [API æ–‡æ¡£](./docs/swagger.yaml)
- [å¼€å‘è„šæœ¬è¯´æ˜](./scripts/README.md)

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿›é¡¹ç›®ï¼
